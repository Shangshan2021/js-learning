<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Title</title>
    <script>

        window.onload=function(){
            var ele_p=document.getElementById('p_cb');
            var ele_b=document.getElementById('box');
            var ele_s=ele_b.getElementsByTagName('input');

            ele_p.onclick=function(){for(i=0;i<ele_s.length;i++){ele_s[i].checked=ele_p.checked;}}

            for(i=0;i<ele_s.length;i++){
                ele_s[i].onclick=function(){
//---------------------------------------------------------

                    ele_s[i].checked=true;		//add
//---------------------------------------------------------
                    var count=0;
                    for(i=0;i<ele_s.length;i++){
                        if(ele_s[i].checked){count++;}
                    }
                    if(count==ele_s.length){ele_p.checked=true;}
                    else{ele_p.checked=false;}
                    alert(count);
                }
            }
        }
    </script>
</head><body>
    <input type="checkbox" name="a" id="p_cb">
    <hr>
    <div id="box">
        <input type="checkbox" name="b" id="cb2"><input type="checkbox" name="c" id="cb3"><input type="checkbox" name="d" id="cb4">
    </div>
</body></html>